# Репликация файла

Реализация клиент-серверного приложения для репликации файла с сервера на клиенты. Файл может только дополняться.

## Запуск

### Подготовка приложения

Необходимо установить все модули описанные в cpanfile
```
carton install 
```

### Запуск приложения

для сервера: 
```
./bin/server.sh
```

для клиента:
```
./bin/client.sh 
```

для клиента-администратора:
```
./bin/admin-client.sh 
```

### Как работает

Сервер ожидает определенные команды от клиентов.

#### Клиент

* -f

Данной командой клиент опрашивает сервер, как будет называться файл для репликации.
Ответ сервера будет примерно такой: 
```
-f data/test.txt
```
Получив ответ клиент создаст файл data/client/data/test.txt

* -i \d+

Эта команда спросит сервер, что есть после N-го байта в файле, происходит в случаях: 
 - когда клиент в ответ на пред команду от сервера создает новый файл в этом случае команда выглядит "-i 0"
 - по таймауту, каждые полсекунды, опрашивается сервер на предмет новых данных "-i $size", передается размер файла.
 - после синхронизации данных.

 Ответ сервера: 

```
-i \d+ [0,1]
```
Например "-i 10 1" здесь сервер сообщает, что сейчас файл имеет больше 10 байт.
"-i 50 0" - а здесь, что меньше 50.

Как только клиент узнает, что файл можно дополнить, он вышлет следующую команду:


* -d \d+

Данная команда уже попросит сервер выдать контент после N-го байта в файле и допишет его(контент) в собственный. Перевод строки заменится на {n} на время передачи данных. Клиент же произведет обратное преобразование.

формат ответа 
```
-d \d+ .+
```
Пример:

```
-d 50 123123123213213{n}13123213123{n}123{n}12{n}321{n}321{n}{n}{n}{n}123{n}123{n}{n}{n}{n}sdfsdfs{n}df{n}sdfsd{n}f{n}{n}{n}sdf{n}{n}{n}{n}qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq
```

Дальше же клиент опять будет опрашивать сервер на предмет следующих данных.


Администратор-клиент

Представлен как аналог телнет-клиента. Команды следует писать в терминал. У каждой команды есть сокращение. Можно использовать их 

* -l, list  - Вернет список команд, вообще доступных.
* -h [alias], help [command] - Вернет справку по команде.
* -q, quit - Выйти.
* -c, connections - Без параметров выведет таблицу соединений. С параметрами позволит заставить клиента выполнить команду. 
"-c 6 -q" - собственно приказ клиенту отсоединиться. Это единственная команда которую можно передать от клиента.